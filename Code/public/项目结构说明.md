# TianBa AI 项目结构说明

## 项目概述

TianBa AI 是一个医疗项目管理系统，提供项目方案生成、项目报告生成、OCR识别和文件加密解密等功能。本文档描述了项目的实际架构结构。

## 项目整体结构

```
TianBa_AI/
├── Code/                     # 后端代码目录
├── Web/                      # 前端代码目录
├── Start/                    # 启动脚本目录
├── LICENSE                   # 许可证文件
└── README.md                 # 项目说明文档
```

## 后端代码结构 (Code/)

```
Code/
├── app/                      # 应用程序核心代码
│   ├── api/                  # API路由层
│   │   └── v1/              # API版本1
│   │       ├── plan_api.py   # 项目方案API
│   │       ├── report_api.py # 项目报告API
│   │       ├── project_plan/ # 项目方案API目录
│   │       │   ├── tumor_chinese.py    # 肿瘤科中文方案API
│   │       │   └── tumor_english.py    # 肿瘤科英文方案API
│   │       └── project_report/ # 项目报告API目录
│   │           └── tumor_chinese.py    # 肿瘤科中文报告API
│   │
│   ├── data/                 # 数据访问层
│   │   ├── common/           # 通用SQL查询
│   │   ├── connection.py     # 数据库连接管理
│   │   ├── project_plan/     # 项目方案查询
│   │   │   ├── dosage_plan.py # 剂量计划查询
│   │   │   ├── project_info.py # 项目信息查询
│   │   │   └── supplies_info.py # 供应信息查询
│   │   └── project_report/   # 项目报告查询
│   │       ├── dosage_plan.py # 剂量计划查询
│   │       ├── project_info.py # 项目信息查询
│   │       └── supplies_info.py # 供应信息查询
│   │
│   ├── services/             # 业务逻辑层
│   │   ├── project_plan/     # 项目方案服务
│   │   │   ├── tumor/       # 肿瘤科
│   │   │   │   ├── chinese/  # 中文版本
│   │   │   │   │   ├── master.py           # 主服务
│   │   │   │   │   ├── export_sql_service.py # SQL导出服务
│   │   │   │   │   ├── fill_word_service.py # Word填充服务
│   │   │   │   │   └── add_info_service.py  # 信息添加服务
│   │   │   │   └── english/  # 英文版本
│   │   │   │       ├── master.py           # 主服务
│   │   │   │       ├── export_sql_service.py # SQL导出服务
│   │   │   │       ├── fill_word_service.py # Word填充服务
│   │   │   │       └── add_info_service.py  # 信息添加服务
│   │   │   └── autoimmune/  # 自身免疫科
│   │   └── project_report/   # 项目报告服务
│   │       └── tumor/       # 肿瘤科
│   │           ├── chinese/  # 中文版本
│   │           │   ├── master.py           # 主服务
│   │           │   ├── export_sql.py       # SQL导出
│   │           │   ├── fill_word.py        # Word填充
│   │           │   ├── add_info.py         # 信息添加
│   │           │   ├── reloading.py        # 图片处理
│   │           │   ├── Excel_extract/      # Excel提取
│   │           │   │   ├── All_Flow.py     # 主流程
│   │           │   │   ├── excel_download.py # Excel下载
│   │           │   │   ├── sup_info.py     # 补充信息
│   │           │   │   ├── form_7_1.py     # 表格7.1
│   │           │   │   ├── form_7_2.py     # 表格7.2
│   │           │   │   ├── form_7_3.py     # 表格7.3
│   │           │   │   ├── add_second.py   # 添加二级
│   │           │   │   ├── P_compute.py    # P值计算
│   │           │   │   └── graphpad_helper.py # GraphPad辅助
│   │           │   └── Figure_extract/     # 图片提取
│   │           │       ├── download.py     # 图片下载
│   │           │       └── reduction.py    # 图片压缩
│   │           └── english/  # 英文版本
│   │
│   ├── main/                 # 应用程序入口
│   │   └── main.py          # FastAPI应用入口
│   │
│   ├── tasks/                # 异步任务
│   └── utils/                # 工具函数
│       ├── OCR/              # OCR相关工具
│       │   ├── paddle_ocr.py # PaddleOCR实现
│       │   ├── pre_pdf.py   # PDF预处理
│       │   ├── scxk.py      # 文件处理
│       │   └── search_and_download_pdf.py # PDF搜索下载
│       ├── Solve/            # 加密解密工具
│       │   ├── Hakimi.py     # 加密解密实现
│       │   └── lib/          # 相关库文件
│       │       └── drmediWrapper.py # DRM包装器
│       └── Translate/        # 翻译工具
│           ├── single_word.py # 单词翻译
│           └── single_excel.py # Excel翻译
│
├── config/                   # 配置文件
│   └── settings.py          # 应用设置
│
├── docs/                     # 文档和生成文件
│   ├── logs/                # 日志文件
│   ├── output/              # 输出文件
│   │   ├── project_plan/    # 项目方案输出
│   │   └── project_report/  # 项目报告输出
│   ├── temp/                # 临时文件
│   │   ├── photo/           # 图片临时文件
│   │   ├── project_plan/    # 项目方案临时文件
│   │   └── project_report/  # 项目报告临时文件
│   └── templates/           # 模板文件
│       ├── project_plan/    # 项目方案模板
│       └── project_report/   # 项目报告模板
│
├── public/                   # 静态资源
│   ├── Peppa.jpg            # 示例图片
│   ├── 项目结构说明.md       # 本文档
│   └── requirements.txt     # Python依赖
│
└── tests/                    # 测试代码
```

## 前端代码结构 (Web/)

```
Web/
├── apps/                     # 应用程序
│   ├── backend-mock/         # 后端模拟服务
│   └── web-antd/            # 前端应用(基于Ant Design)
│
├── internal/                 # 内部工具
│   ├── lint-configs/         # 代码检查配置
│   ├── node-utils/           # Node.js工具
│   ├── tailwind-config/      # Tailwind CSS配置
│   ├── tsconfig/             # TypeScript配置
│   └── vite-config/          # Vite构建配置
│
├── packages/                 # 共享包
│   ├── @core/                # 核心功能
│   ├── constants/            # 常量定义
│   ├── effects/              # 副作用处理
│   ├── icons/                # 图标
│   ├── locales/              # 国际化
│   ├── preferences/          # 偏好设置
│   ├── stores/               # 状态管理
│   ├── styles/               # 样式
│   ├── types/                # 类型定义
│   └── utils/                # 工具函数
│
├── scripts/                  # 脚本
│   ├── clean.mjs             # 清理脚本
│   ├── deploy/               # 部署脚本
│   ├── turbo-run/            # Turbo运行脚本
│   └── vsh/                  # 虚拟Shell脚本
│
├── .browserslistrc           # 浏览器兼容性配置
├── .turbo/                   # Turbo缓存
├── .vscode/                  # VS Code配置
├── package.json              # 项目配置
├── pnpm-lock.yaml            # 依赖锁定文件
├── pnpm-workspace.yaml       # PNPM工作区配置
└── turbo.json                # Turbo配置
```

## 启动脚本结构 (Start/)

```
Start/
├── start.bat                 # Windows启动脚本
├── start.sh                  # Linux/Mac启动脚本
└── stop.sh                   # 停止脚本
```

## 架构设计原则

### 1. 分层架构
- **API层**：处理HTTP请求和响应，负责参数验证和路由
- **Service层**：实现核心业务逻辑，处理数据转换和业务规则
- **Data层**：负责数据访问，封装SQL查询和数据库操作
- **Utils层**：提供可复用的工具函数

### 2. 模块化设计
- 按功能模块划分（project_plan、project_report等）
- 按疾病类型细分（tumor、autoimmune等）
- 按语言版本细分（chinese、english等）
- 前后端分离，各自独立开发和部署

### 3. 配置管理
- 集中管理所有配置文件
- 支持环境变量覆盖
- 分离敏感信息和常规配置

## 核心功能模块

### 1. 项目方案生成 (Project Plan)
- 支持肿瘤科和自身免疫科
- 支持中文和英文版本
- 生成Excel和Word文档
- 提供剂量计划和供应信息查询

### 2. 项目报告生成 (Project Report)
- 支持多种报告类型（周报、月报、终报等）
- 支持图表和图片处理
- 提供Excel数据提取功能
- 支持GraphPad数据处理

### 3. OCR识别
- 处理PDF和图片文件
- 提取文本信息
- 支持多种文档格式
- 基于PaddleOCR实现

### 4. 文件加密解密
- 保护敏感文件
- 支持批量处理
- 提供权限控制
- 基于DRM技术实现

### 5. 翻译功能
- 支持单词翻译
- 支持Excel文档翻译
- 基于第三方翻译API

## 技术栈

### 后端技术栈
- **框架**: FastAPI
- **数据库**: MySQL (通过SQLAlchemy ORM)
- **数据处理**: Pandas, NumPy
- **文档处理**: python-docx, docxtpl, openpyxl
- **OCR**: PaddleOCR
- **图像处理**: OpenCV, Pillow
- **PDF处理**: PyMuPDF
- **加密解密**: 自定义DRM解决方案
- **网络请求**: requests
- **并发处理**: concurrent-futures
- **翻译**: translate库

### 前端技术栈
- **框架**: React
- **UI库**: Ant Design
- **构建工具**: Vite
- **包管理**: PNPM
- **状态管理**: 未明确指定
- **样式**: Tailwind CSS

## 数据流

1. **请求流程**：
   - 前端(Web)发送HTTP请求
   - 后端API层(Code/app/api)接收请求
   - 调用Service层(Code/app/services)处理业务逻辑
   - Service层通过Data层(Code/app/data)访问数据库
   - 返回结果给API层
   - API层格式化响应并返回给前端

2. **配置访问**：
   - Service层从config目录读取配置
   - Data层使用connection.py管理数据库连接
   - 所有层都可以访问utils中的工具函数

3. **文件处理流程**：
   - 文件上传到临时目录
   - OCR或加密处理
   - 结果保存到输出目录
   - 通过API返回文件路径或下载链接

## 部署架构

1. **前端应用**：基于React和Ant Design的单页应用
2. **后端应用**：FastAPI应用，处理HTTP请求
3. **开发环境**：使用PNPM和Turbo进行包管理和构建
4. **API服务**：
   - 项目方案API (plan_api.py)
   - 项目报告API (report_api.py)
5. **服务器**：使用uvicorn作为ASGI服务器

## 开发规范

1. **代码组织**：
   - 每个模块有明确的职责
   - 避免循环依赖
   - 使用依赖注入

2. **错误处理**：
   - 统一的异常处理机制
   - 详细的错误日志
   - 用户友好的错误信息

3. **测试**：
   - 单元测试覆盖核心业务逻辑
   - 集成测试验证API接口
   - 性能测试确保系统稳定性

## 总结

项目架构遵循简洁性、模块化和可扩展性的原则，既满足了当前业务需求，又为未来功能扩展提供了良好的基础。通过分层架构和模块化设计，实现了代码的高内聚、低耦合，提高了系统的可维护性和可扩展性。同时，前后端分离的架构使得开发更加灵活，便于团队协作。

项目采用了现代化的技术栈，后端使用FastAPI提供高性能的API服务，前端使用React和Ant Design构建用户友好的界面。通过合理的目录结构和模块划分，使得代码易于理解和维护。